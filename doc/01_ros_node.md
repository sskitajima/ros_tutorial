# ROSチュートリアル第1回

ROSのインストールは済ませているものとする。





### 1.簡単なROSノードの作成

1. **パッケージを作る**

```sh
# catkin_create_pkg [package name] [dependent packages]
catkin_create_pkg ros_tutorial roscpp rospy image_transport cv_bridge
```

パッケージを作成した後でも、依存関係は追加することができる。



- ROSのパッケージの意義

ROSでは、パッケージと呼ばれる単位でプログラムを管理する。パッケージで区別してプログラムを区切ると、プログラムの再利用がしやすくなる。簡単に言えば、処理Aを行うプログラムと処理Bを行うプログラムを合わせてモジュールXを最初に作成し、その後、処理Aと処理Cを合わせたモジュールYを作成したくなったとき、処理Aと処理Bが密結合したコードになっていると、プログラムの再利用がしにくい。処理を分けて、その間のインタフェース（データ通信、依存関係の記述など）の仕組みが整えられていることがROSの特徴である。



- 自動的に作られるファイルについて

パッケージを作成すると、フォルダと、`package.xml`、`CMakeLists.txt`が作成される。

`packege.xml`は、パッケージ名、パッケージの作者、ライセンス、パッケージの依存関係、メタデータを記述することができるファイルである。パッケージ名は、フォルダの名前で決まるのではなく、このxmlファイルの中身で決まる。`rospack find [package name]`や`roscd [package name]`でこれらを確かめられる。

`CMakeLists.txt`は、ビルドについての設定ファイルであり、cmakeというC++のビルドで使われるツールで使われるファイルでもある。どのソースコードを使ってどのバイナリ（PCが直接実行できるファイル）を作るか、どの外部ライブラリを使うか、PC中にインストールするならどの場所にインストールするのか、などを記述する。このファイル自体はROS以外のC++プログラムでも使われるものだが、ROSでは一般的に使われているcmakeの文法に加えて、独自の命令も使う。



2. **画像を用意する**

```bash
roscd ros_tutorial
mkdir image

# image配下に画像を置く
```

今回のチュートリアルで使う画像を配置する。



3. **ソースファイルをコーディングする**

画像ファイルのパスは変更する。

具体的な内容についてはソースコード中のコメントを参照。



3. **CMakeLists.txtを更新する**

cmakeの文法については様々なものがある。インストールしてプログラムを公開する際にはきちんと書かなければならないが、最低限必要なもののみの説明を以下に示す。

`find_package`

`catkin_package`

`include_directories`

`add_executable`

`add_library`

`target_link_libraries`

3. **ビルドする**

```bash
# $HOME 以外の場所にワークスペースを作っている場合は適宜変更する
cd ~/catkin_ws
catkin_make
```

CMakeLists.txtを読み込んでワークスペース中のすべてのパッケージの依存関係をチェックした後、コンパイル、リンクを行う。

メッセージが大量に流れるが、エラーが出る場合はその内容をきちんと読もう。



5. **実行してみる**

```bash
# terminal 1
roscore

# terminal 2
rosrun ros_tutorial ros_tutorial_image_publisher


# terminal 3
rosrun ros_tutorial ros_tutorial_image_subscriber
```



## 2.launchファイルの記述

 

```
pkg...package name
type...executable name
name...ros node name 
output...terminal output
```



## 3.orb_slam2_rosでの実行

orb_slam2_testの、トピック名のみを変える	



```bash
roslaunch orb_slam2_ros orb_slam2_test
```



### プログラミング基礎用語

ROSとは関係のない一般的な用語についての簡単なリファレンス。筆者の理解に基づくものなので、正確性は保証しない。

- ビルド
  プリプロセス→コンパイル→リンク によって、ソースコードから実行ファイルやライブラリを作ること
- プリプロセス
  C++のビルドの手順の1つで、#include命令や#define命令を展開する（置き換える）処理などを指す
- コンパイル
  ソースファイルを1ファイルずつ対応させて機械語で書かれたオブジェクトファイルにする処理
- リンク
  1つずつのオブジェクトファイルをまとめ、実行ファイルやライブラリを作る
- 実行ファイル
  プログラムがそのまま実行できる形式（機械語：バイナリ形式）のファイル
- ライブラリ
  他の実行ファイルから呼び出されて実行されるファイル
- 依存関係
  あるプログラムの実行のために、別のプログラムの存在を必要としていること、そのことを前提としてプログラムが作られていること。

### 参考資料

ROSロボットプログラミングバイブル、オーム社

ROS公式HPのチュートリアル